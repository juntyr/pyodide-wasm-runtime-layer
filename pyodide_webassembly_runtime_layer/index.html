<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="CI Status MSRV Latest Version Rust Doc Crate Rust Doc Main"><title>pyodide_webassembly_runtime_layer - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-42fa08075bb476ff.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="pyodide_webassembly_runtime_layer" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0-nightly (2bd1e894e 2024-09-26)" data-channel="nightly" data-search-js="search-e056c65ede92db13.js" data-settings-js="settings-805db61a62df4bd2.js" ><script src="../static.files/storage-1d39b6787ed640ff.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-54bc299d2a5e4e43.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-0111fcff984fae8f.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../pyodide_webassembly_runtime_layer/index.html">pyodide_<wbr>webassembly_<wbr>runtime_<wbr>layer</a><span class="version">0.4.2</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#memory-management" title="Memory Management">Memory Management</a></li></ul><h3><a href="#structs">Crate Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>pyodide_webassembly_runtime_layer</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/pyodide_webassembly_runtime_layer/lib.rs.html#1-118">source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><a href="https://github.com/juntyr/pyodide-webassembly-runtime-layer/actions/workflows/ci.yml?query=branch%3Amain"><img src="https://img.shields.io/github/actions/workflow/status/juntyr/pyodide-webassembly-runtime-layer/ci.yml?branch=main" alt="CI Status" /></a> <a href="https://github.com/juntyr/pyodide-webassembly-runtime-layer"><img src="https://img.shields.io/badge/MSRV-1.76.0-blue" alt="MSRV" /></a> <a href="https://crates.io/crates/pyodide-webassembly-runtime-layer"><img src="https://img.shields.io/crates/v/pyodide-webassembly-runtime-layer" alt="Latest Version" /></a>
<a href="https://docs.rs/pyodide-webassembly-runtime-layer/"><img src="https://img.shields.io/docsrs/pyodide-webassembly-runtime-layer" alt="Rust Doc Crate" /></a> <a href="https://juntyr.github.io/pyodide-webassembly-runtime-layer/pyodide_webassembly_runtime_layer"><img src="https://img.shields.io/badge/docs-main-blue" alt="Rust Doc Main" /></a></p>
<p><code>pyodide-webassembly-runtime-layer</code> implements the <a href="https://docs.rs/wasm_runtime_layer/0.4/"><code>wasm_runtime_layer</code></a>
backend API to provide access to the web browser’s <a href="https://developer.mozilla.org/en-US/docs/WebAssembly"><code>WebAssembly</code></a> runtime
using <a href="https://pyodide.org/en/stable/"><code>Pyodide</code></a>.</p>
<p>The implementation of this crate is heavily inspired by the
<a href="https://docs.rs/js_wasm_runtime_layer/0.4/"><code>js_wasm_runtime_layer</code></a> backend for the <a href="https://docs.rs/wasm_runtime_layer/0.4/"><code>wasm_runtime_layer</code></a>. Instead of
relying on the <a href="https://docs.rs/js-sys/"><code>js-sys</code></a> and <a href="https://docs.rs/wasm-bindgen/"><code>wasm-bindgen</code></a> crates to generate
JavaScript-based bindings to the <a href="https://developer.mozilla.org/en-US/docs/WebAssembly"><code>WebAssembly</code></a> JavaScript API, this crate
uses <a href="https://pyodide.org/en/stable/"><code>Pyodide</code></a>’s <a href="https://pyodide.org/en/stable/usage/api/python-api.html"><code>js</code></a> FFI layer to interact with <a href="https://developer.mozilla.org/en-US/docs/WebAssembly"><code>WebAssembly</code></a> through
Python running inside WASM. <code>pyodide-webassembly-runtime-layer</code> is therefore
useful when developing a Python module in Rust, e.g. using <a href="https://docs.rs/pyo3/0.22/"><code>PyO3</code></a>, which
requires access to some WASM runtime using the <a href="https://docs.rs/wasm_runtime_layer/0.4/"><code>wasm_runtime_layer</code></a> API
and may be deployed to the web itself using <a href="https://pyodide.org/en/stable/"><code>Pyodide</code></a>.</p>
<h3 id="memory-management"><a class="doc-anchor" href="#memory-management">§</a>Memory Management</h3>
<p><code>pyodide-webassembly-runtime-layer</code> generally tries to keep memory
management intuitive by relying primarily on Python’s reference counting to
drop objects once they are no longer needed by both the user-written Rust
code and the <a href="https://developer.mozilla.org/en-US/docs/WebAssembly"><code>WebAssembly</code></a> runtime. As this crate coordinates interop
across Rust, Python, and JavaScript, it takes extra care to avoid reference
cycles across the different memory management strategies of the languages
which would otherwise lead to memory leakage. If using this crate produces a
memory leak that is avoided with a different <a href="https://docs.rs/wasm_runtime_layer/0.4/"><code>wasm_runtime_layer</code></a> backend,
please <a href="https://github.com/juntyr/pyodide-webassembly-runtime-layer/issues/new">report it as a bug</a>.</p>
<p>There is one exception to the intuitive memory management strategy:</p>
<ul>
<li><a href="https://docs.rs/wasm_runtime_layer/0.4/wasm_runtime_layer/struct.Func.html#method.new"><code>Func::new</code></a> creates a host function, which may capture arbitrary data.
To avoid cross-language reference cycles, it is stored using <a href="https://docs.rs/wobbly/0.1/"><code>wobbly</code></a>
references inside the <a href="https://docs.rs/wasm_runtime_layer/0.4/wasm_runtime_layer/struct.Func.html"><code>Func</code></a> and its associated <a href="https://docs.rs/wasm_runtime_layer/0.4/wasm_runtime_layer/struct.Store.html"><code>Store</code></a>. Even though
the host function and its data are dropped once either the <a href="https://docs.rs/wasm_runtime_layer/0.4/wasm_runtime_layer/struct.Store.html"><code>Store</code></a> is
dropped or references to the <a href="https://docs.rs/wasm_runtime_layer/0.4/wasm_runtime_layer/struct.Func.html"><code>Func</code></a> are dropped, additional bookkeeping
data is required until both have been dropped.</li>
</ul>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Engine.html" title="struct pyodide_webassembly_runtime_layer::Engine">Engine</a></div><div class="desc docblock-short">Runtime for <a href="https://developer.mozilla.org/en-US/docs/WebAssembly"><code>WebAssembly</code></a> web runtime.</div></li><li><div class="item-name"><a class="struct" href="struct.ExternRef.html" title="struct pyodide_webassembly_runtime_layer::ExternRef">Extern<wbr>Ref</a></div><div class="desc docblock-short">Extern host reference type.</div></li><li><div class="item-name"><a class="struct" href="struct.Func.html" title="struct pyodide_webassembly_runtime_layer::Func">Func</a></div><div class="desc docblock-short">A bound function, which may be an export from a WASM <a href="struct.Instance.html" title="struct pyodide_webassembly_runtime_layer::Instance"><code>Instance</code></a> or a host
function.</div></li><li><div class="item-name"><a class="struct" href="struct.Global.html" title="struct pyodide_webassembly_runtime_layer::Global">Global</a></div><div class="desc docblock-short">A global variable accesible as an import or export in a module.</div></li><li><div class="item-name"><a class="struct" href="struct.Instance.html" title="struct pyodide_webassembly_runtime_layer::Instance">Instance</a></div><div class="desc docblock-short">An instantiated instance of a WASM <a href="struct.Module.html" title="struct pyodide_webassembly_runtime_layer::Module"><code>Module</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.Memory.html" title="struct pyodide_webassembly_runtime_layer::Memory">Memory</a></div><div class="desc docblock-short">A WASM memory.</div></li><li><div class="item-name"><a class="struct" href="struct.Module.html" title="struct pyodide_webassembly_runtime_layer::Module">Module</a></div><div class="desc docblock-short">A WASM module.</div></li><li><div class="item-name"><a class="struct" href="struct.Store.html" title="struct pyodide_webassembly_runtime_layer::Store">Store</a></div><div class="desc docblock-short">A store for the <a href="struct.Engine.html" title="struct pyodide_webassembly_runtime_layer::Engine"><code>Engine</code></a>, which stores host-defined data <code>T</code> and internal
state.</div></li><li><div class="item-name"><a class="struct" href="struct.StoreContext.html" title="struct pyodide_webassembly_runtime_layer::StoreContext">Store<wbr>Context</a></div><div class="desc docblock-short">Immutable context to the store</div></li><li><div class="item-name"><a class="struct" href="struct.StoreContextMut.html" title="struct pyodide_webassembly_runtime_layer::StoreContextMut">Store<wbr>Context<wbr>Mut</a></div><div class="desc docblock-short">Mutable context to the store</div></li><li><div class="item-name"><a class="struct" href="struct.Table.html" title="struct pyodide_webassembly_runtime_layer::Table">Table</a></div><div class="desc docblock-short">A WASM table.</div></li></ul></section></div></main></body></html>